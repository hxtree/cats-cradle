"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotationCodec = void 0;
const Collection_1 = require("./Collection");
const Cup_1 = require("./Cup");
const Dice_1 = require("./Dice");
/**
 * Codec that encodes objects to notations and decodes notations to objects.
 */
class NotationCodec {
    //private _cup;
    constructor() {
        this._separator = ',';
        this._cup = '2';
        //name: string) {
        //  this._cup = name;
    }
    get cup() {
        return this._cup;
    }
    /**
     * Encode from a cup to a string
     * @param cup - the cup to encode
     * @returns
     */
    encodeCup(cup) {
        let notation = '';
        let firstIteration = true;
        cup.forEach((collection) => {
            if (firstIteration) {
                firstIteration = false;
            }
            else {
                notation += this._separator;
            }
            notation += this.encodeCollection(collection);
        });
        return notation;
    }
    /**
     * Encode from a collection to a string
     * @param collection - the collection to encode
     * @returns
     */
    encodeCollection(collection) {
        let notation = '';
        const amount = collection.count();
        if (amount > 1) {
            notation += amount;
        }
        const sides = collection.sides;
        if (sides === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + sides;
        }
        const modifier = collection.modifier;
        if (modifier > 0) {
            notation += '+' + Math.abs(modifier);
        }
        else if (modifier < 0) {
            notation += '-' + Math.abs(modifier);
        }
        const multiplier = collection.multiplier;
        if (multiplier > 1) {
            notation += '*' + multiplier;
        }
        return notation;
    }
    /**
     * Encode from a dice to a string
     */
    encodeDice(dice) {
        let notation = '';
        if (dice.max === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + dice.max;
        }
        return notation;
    }
    /**
     * Decodes a dice cup notation
     * @param notation - 1d6+2*8,1d10,2d%
     */
    decodeCup(notation) {
        const expressionParts = notation.toLowerCase().split(this._separator);
        const cup = new Cup_1.Cup();
        expressionParts.forEach((expressionPart) => {
            cup.push(this.decodeCollection(expressionPart));
        });
        return cup;
    }
    /**
     * Decodes a dice collection notation
     * @param notation - 1d6+2*8
     * @returns ICollection
     */
    decodeCollection(notation) {
        let amount = 1;
        let sides = 2;
        let multiplier = 1;
        let modifier = 0;
        let unsorted = notation.split('d');
        amount = unsorted[0] !== '' ? Number(unsorted[0]) : 1;
        unsorted = unsorted[1].split('*');
        if (!this._isEmpty(unsorted[1])) {
            multiplier = Number(unsorted[1]);
        }
        if (unsorted[0].includes('+') !== false) {
            unsorted = unsorted[0].split('+');
            modifier = unsorted[1] !== null ? Number(unsorted[1]) : 0;
        }
        else if (unsorted[0].includes('-') !== false) {
            unsorted = unsorted[0].split('-');
            modifier = unsorted[1] !== null ? 0 - Number(unsorted[1]) : 0;
        }
        if (unsorted[0] === '%') {
            sides = 100;
        }
        else {
            sides = Number(unsorted[0]);
        }
        return new Collection_1.Collection(amount, sides, modifier, multiplier);
    }
    decodeDice(notation) {
        if (notation.charAt(0).toLowerCase() !== 'd') {
            throw new Error('Invalid dice notation');
        }
        const number = Number(notation.substring(1));
        return new Dice_1.Dice(number);
    }
    /**
     * Determine whether string is empty or not
     * @param string - the string to check
     * @returns
     */
    _isEmpty(string) {
        return !string || string.length === 0;
    }
}
exports.NotationCodec = NotationCodec;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90YXRpb25Db2RlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Ob3RhdGlvbkNvZGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZDQUdzQjtBQUN0QiwrQkFHZTtBQUNmLGlDQUdnQjtBQVloQjs7R0FFRztBQUNILE1BQWEsYUFBYTtJQUl0QixlQUFlO0lBRWY7UUFMUSxlQUFVLEdBQVcsR0FBRyxDQUFDO1FBQ3pCLFNBQUksR0FBVyxHQUFHLENBQUM7UUFLdkIsaUJBQWlCO1FBQ2pCLHFCQUFxQjtJQUN6QixDQUFDO0lBRUQsSUFBVyxHQUFHO1FBQ1YsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksU0FBUyxDQUFDLEdBQVM7UUFDdEIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBRWxCLElBQUksY0FBYyxHQUFHLElBQUksQ0FBQztRQUMxQixHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBdUIsRUFBRSxFQUFFO1lBQ3BDLElBQUksY0FBYyxFQUFFO2dCQUNoQixjQUFjLEdBQUcsS0FBSyxDQUFDO2FBQzFCO2lCQUFNO2dCQUNILFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDO2FBQy9CO1lBRUQsUUFBUSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksZ0JBQWdCLENBQUMsVUFBdUI7UUFDM0MsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQyxJQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDWixRQUFRLElBQUksTUFBTSxDQUFDO1NBQ3RCO1FBRUQsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLEtB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c0NBd0pDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICAgIENvbGxlY3Rpb24sXHJcbiAgICBJQ29sbGVjdGlvblxyXG59IGZyb20gJy4vQ29sbGVjdGlvbic7XHJcbmltcG9ydCB7XHJcbiAgICBDdXAsXHJcbiAgICBJQ3VwXHJcbn0gZnJvbSAnLi9DdXAnO1xyXG5pbXBvcnQge1xyXG4gICAgRGljZSxcclxuICAgIElEaWNlXHJcbn0gZnJvbSAnLi9EaWNlJztcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgSU5vdGF0aW9uQ29kZWMge1xyXG4gICAgZ2V0IGN1cCgpOiBzdHJpbmc7XHJcbiAgICBlbmNvZGVDdXAoY3VwOiBJQ3VwKTogc3RyaW5nO1xyXG4gICAgZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBJQ29sbGVjdGlvbik6IHN0cmluZztcclxuICAgIGVuY29kZURpY2UoZGljZTogSURpY2UpOiBzdHJpbmc7XHJcbiAgICBkZWNvZGVDdXAobm90YXRpb246IHN0cmluZyk6IElDdXA7XHJcbiAgICBkZWNvZGVDb2xsZWN0aW9uKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ29sbGVjdGlvbjtcclxuICAgIGRlY29kZURpY2Uobm90YXRpb246IHN0cmluZyk6IElEaWNlOyBcclxufVxyXG5cclxuLyoqXHJcbiAqIENvZGVjIHRoYXQgZW5jb2RlcyBvYmplY3RzIHRvIG5vdGF0aW9ucyBhbmQgZGVjb2RlcyBub3RhdGlvbnMgdG8gb2JqZWN0cy5cclxuICovXHJcbmV4cG9ydCBjbGFzcyBOb3RhdGlvbkNvZGVjIHtcclxuICAgIHByaXZhdGUgX3NlcGFyYXRvcjogc3RyaW5nID0gJywnO1xyXG4gICAgcHJpdmF0ZSBfY3VwOiBzdHJpbmcgPSAnMic7XHJcblxyXG4gICAgLy9wcml2YXRlIF9jdXA7XHJcblxyXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIC8vbmFtZTogc3RyaW5nKSB7XHJcbiAgICAgICAgLy8gIHRoaXMuX2N1cCA9IG5hbWU7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGdldCBjdXAoKTogc3RyaW5nIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY3VwO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRW5jb2RlIGZyb20gYSBjdXAgdG8gYSBzdHJpbmdcclxuICAgICAqIEBwYXJhbSBjdXAgLSB0aGUgY3VwIHRvIGVuY29kZVxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGVuY29kZUN1cChjdXA6IElDdXApOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBub3RhdGlvbiA9ICcnO1xyXG5cclxuICAgICAgICBsZXQgZmlyc3RJdGVyYXRpb24gPSB0cnVlO1xyXG4gICAgICAgIGN1cC5mb3JFYWNoKChjb2xsZWN0aW9uOiBJQ29sbGVjdGlvbikgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZmlyc3RJdGVyYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGZpcnN0SXRlcmF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBub3RhdGlvbiArPSB0aGlzLl9zZXBhcmF0b3I7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIG5vdGF0aW9uICs9IHRoaXMuZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG5vdGF0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogRW5jb2RlIGZyb20gYSBjb2xsZWN0aW9uIHRvIGEgc3RyaW5nXHJcbiAgICAgKiBAcGFyYW0gY29sbGVjdGlvbiAtIHRoZSBjb2xsZWN0aW9uIHRvIGVuY29kZVxyXG4gICAgICogQHJldHVybnNcclxuICAgICAqL1xyXG4gICAgcHVibGljIGVuY29kZUNvbGxlY3Rpb24oY29sbGVjdGlvbjogSUNvbGxlY3Rpb24pOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBub3RhdGlvbiA9ICcnO1xyXG4gICAgICAgIGNvbnN0IGFtb3VudCA9IGNvbGxlY3Rpb24uY291bnQoKTtcclxuICAgICAgICBpZiAoYW1vdW50ID4gMSkge1xyXG4gICAgICAgICAgICBub3RhdGlvbiArPSBhbW91bnQ7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjb25zdCBzaWRlcyA9IGNvbGxlY3Rpb24uc2lkZXM7XHJcbiAgICAgICAgaWYgKHNpZGVzID09PSAxMDApIHtcclxuICAgICAgICAgICAgbm90YXRpb24gKz0gJ2QlJztcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBub3RhdGlvbiArPSAnZCcgKyBzaWRlcztcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSBjb2xsZWN0aW9uLm1vZGlmaWVyO1xyXG4gICAgICAgIGlmIChtb2RpZmllciA+IDApIHtcclxuICAgICAgICAgICAgbm90YXRpb24gKz0gJysnICsgTWF0aC5hYnMobW9kaWZpZXIpO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobW9kaWZpZXIgPCAwKSB7XHJcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICctJyArIE1hdGguYWJzKG1vZGlmaWVyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBjb2xsZWN0aW9uLm11bHRpcGxpZXI7XHJcbiAgICAgICAgaWYgKG11bHRpcGxpZXIgPiAxKSB7XHJcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICcqJyArIG11bHRpcGxpZXI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gbm90YXRpb247XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFbmNvZGUgZnJvbSBhIGRpY2UgdG8gYSBzdHJpbmdcclxuICAgICAqL1xyXG4gICAgcHVibGljIGVuY29kZURpY2UoZGljZTogSURpY2UpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBub3RhdGlvbiA9ICcnO1xyXG4gICAgICAgIGlmIChkaWNlLm1heCA9PT0gMTAwKSB7XHJcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICdkJSc7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm90YXRpb24gKz0gJ2QnICsgZGljZS5tYXg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub3RhdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlY29kZXMgYSBkaWNlIGN1cCBub3RhdGlvblxyXG4gICAgICogQHBhcmFtIG5vdGF0aW9uIC0gMWQ2KzIqOCwxZDEwLDJkJVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZGVjb2RlQ3VwKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ3VwIHtcclxuICAgICAgICBjb25zdCBleHByZXNzaW9uUGFydHMgPSBub3RhdGlvbi50b0xvd2VyQ2FzZSgpLnNwbGl0KHRoaXMuX3NlcGFyYXRvcik7XHJcbiAgICAgICAgY29uc3QgY3VwID0gbmV3IEN1cCgpO1xyXG5cclxuICAgICAgICBleHByZXNzaW9uUGFydHMuZm9yRWFjaCgoZXhwcmVzc2lvblBhcnQ6IHN0cmluZykgPT4ge1xyXG4gICAgICAgICAgICBjdXAucHVzaCh0aGlzLmRlY29kZUNvbGxlY3Rpb24oZXhwcmVzc2lvblBhcnQpKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGN1cDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERlY29kZXMgYSBkaWNlIGNvbGxlY3Rpb24gbm90YXRpb25cclxuICAgICAqIEBwYXJhbSBub3RhdGlvbiAtIDFkNisyKjhcclxuICAgICAqIEByZXR1cm5zIElDb2xsZWN0aW9uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkZWNvZGVDb2xsZWN0aW9uKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ29sbGVjdGlvbiB7XHJcbiAgICAgICAgbGV0IGFtb3VudCA9IDE7XHJcbiAgICAgICAgbGV0IHNpZGVzID0gMjtcclxuICAgICAgICBsZXQgbXVsdGlwbGllciA9IDE7XHJcbiAgICAgICAgbGV0IG1vZGlmaWVyID0gMDtcclxuXHJcbiAgICAgICAgbGV0IHVuc29ydGVkID0gbm90YXRpb24uc3BsaXQoJ2QnKTtcclxuXHJcbiAgICAgICAgYW1vdW50ID0gdW5zb3J0ZWRbMF0gIT09ICcnID8gTnVtYmVyKHVuc29ydGVkWzBdKSA6IDE7XHJcblxyXG4gICAgICAgIHVuc29ydGVkID0gdW5zb3J0ZWRbMV0uc3BsaXQoJyonKTtcclxuXHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc0VtcHR5KHVuc29ydGVkWzFdKSkge1xyXG4gICAgICAgICAgICBtdWx0aXBsaWVyID0gTnVtYmVyKHVuc29ydGVkWzFdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh1bnNvcnRlZFswXS5pbmNsdWRlcygnKycpICE9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICB1bnNvcnRlZCA9IHVuc29ydGVkWzBdLnNwbGl0KCcrJyk7XHJcbiAgICAgICAgICAgIG1vZGlmaWVyID0gdW5zb3J0ZWRbMV0gIT09IG51bGwgPyBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcclxuICAgICAgICB9IGVsc2UgaWYgKHVuc29ydGVkWzBdLmluY2x1ZGVzKCctJykgIT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIHVuc29ydGVkID0gdW5zb3J0ZWRbMF0uc3BsaXQoJy0nKTtcclxuICAgICAgICAgICAgbW9kaWZpZXIgPSB1bnNvcnRlZFsxXSAhPT0gbnVsbCA/IDAgLSBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh1bnNvcnRlZFswXSA9PT0gJyUnKSB7XHJcbiAgICAgICAgICAgIHNpZGVzID0gMTAwO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNpZGVzID0gTnVtYmVyKHVuc29ydGVkWzBdKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvbihhbW91bnQsIHNpZGVzLCBtb2RpZmllciwgbXVsdGlwbGllcik7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRlY29kZURpY2Uobm90YXRpb246IHN0cmluZyk6IElEaWNlIHtcclxuICAgICAgICBpZiAobm90YXRpb24uY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgIT09ICdkJykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZGljZSBub3RhdGlvbicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCBudW1iZXIgPSBOdW1iZXIobm90YXRpb24uc3Vic3RyaW5nKDEpKTtcclxuICAgICAgICByZXR1cm4gbmV3IERpY2UobnVtYmVyKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIERldGVybWluZSB3aGV0aGVyIHN0cmluZyBpcyBlbXB0eSBvciBub3RcclxuICAgICAqIEBwYXJhbSBzdHJpbmcgLSB0aGUgc3RyaW5nIHRvIGNoZWNrXHJcbiAgICAgKiBAcmV0dXJuc1xyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9pc0VtcHR5KHN0cmluZzogc3RyaW5nKTogYm9vbGVhbiB7XHJcbiAgICAgICAgcmV0dXJuICFzdHJpbmcgfHwgc3RyaW5nLmxlbmd0aCA9PT0gMDtcclxuICAgIH1cclxufVxyXG4iXX0=