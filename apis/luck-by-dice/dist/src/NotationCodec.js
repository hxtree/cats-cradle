"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotationCodec = void 0;
const Collection_1 = require("./Collection");
const Cup_1 = require("./Cup");
const Dice_1 = require("./Dice");
/**
 * Codec that encodes objects to notations and decodes notations to objects.
 */
class NotationCodec {
    //private _cup;
    constructor() {
        this._separator = ',';
        this._cup = '2';
        //name: string) {
        //  this._cup = name;
    }
    get cup() {
        return this._cup;
    }
    /**
     * Encode from a cup to a string
     * @param cup - the cup to encode
     * @returns
     */
    encodeCup(cup) {
        let notation = '';
        let firstIteration = true;
        cup.forEach((collection) => {
            if (firstIteration) {
                firstIteration = false;
            }
            else {
                notation += this._separator;
            }
            notation += this.encodeCollection(collection);
        });
        return notation;
    }
    /**
     * Encode from a collection to a string
     * @param collection - the collection to encode
     * @returns
     */
    encodeCollection(collection) {
        let notation = '';
        const amount = collection.count();
        if (amount > 1) {
            notation += amount;
        }
        const sides = collection.sides;
        if (sides === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + sides;
        }
        const modifier = collection.modifier;
        if (modifier > 0) {
            notation += '+' + Math.abs(modifier);
        }
        else if (modifier < 0) {
            notation += '-' + Math.abs(modifier);
        }
        const multiplier = collection.multiplier;
        if (multiplier > 1) {
            notation += '*' + multiplier;
        }
        return notation;
    }
    /**
     * Encode from a dice to a string
     */
    encodeDice(dice) {
        let notation = '';
        if (dice.max === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + dice.max;
        }
        return notation;
    }
    /**
     * Decodes a dice cup notation
     * @param notation - 1d6+2*8,1d10,2d%
     */
    decodeCup(notation) {
        const expressionParts = notation.toLowerCase().split(this._separator);
        const cup = new Cup_1.Cup();
        expressionParts.forEach((expressionPart) => {
            cup.push(this.decodeCollection(expressionPart));
        });
        return cup;
    }
    /**
     * Decodes a dice collection notation
     * @param notation - 1d6+2*8
     * @returns ICollection
     */
    decodeCollection(notation) {
        let amount = 1;
        let sides = 2;
        let multiplier = 1;
        let modifier = 0;
        let unsorted = notation.split('d');
        amount = unsorted[0] !== '' ? Number(unsorted[0]) : 1;
        unsorted = unsorted[1].split('*');
        if (!this._isEmpty(unsorted[1])) {
            multiplier = Number(unsorted[1]);
        }
        if (unsorted[0].includes('+') !== false) {
            unsorted = unsorted[0].split('+');
            modifier = unsorted[1] !== null ? Number(unsorted[1]) : 0;
        }
        else if (unsorted[0].includes('-') !== false) {
            unsorted = unsorted[0].split('-');
            modifier = unsorted[1] !== null ? 0 - Number(unsorted[1]) : 0;
        }
        if (unsorted[0] === '%') {
            sides = 100;
        }
        else {
            sides = Number(unsorted[0]);
        }
        return new Collection_1.Collection(amount, sides, modifier, multiplier);
    }
    decodeDice(notation) {
        if (notation.charAt(0).toLowerCase() !== 'd') {
            throw new Error('Invalid dice notation');
        }
        const number = Number(notation.substring(1));
        return new Dice_1.Dice(number);
    }
    /**
     * Determine whether string is empty or not
     * @param string - the string to check
     * @returns
     */
    _isEmpty(string) {
        return !string || string.length === 0;
    }
}
exports.NotationCodec = NotationCodec;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90YXRpb25Db2RlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9Ob3RhdGlvbkNvZGVjLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLDZDQUdzQjtBQUN0QiwrQkFHZTtBQUNmLGlDQUdnQjtBQVloQjs7R0FFRztBQUNILE1BQWEsYUFBYTtJQUl0QixlQUFlO0lBRWY7UUFMUSxlQUFVLEdBQVcsR0FBRyxDQUFDO1FBQ3pCLFNBQUksR0FBVyxHQUFHLENBQUM7UUFLdkIsaUJBQWlCO1FBQ2pCLHFCQUFxQjtJQUN6QixDQUFDO0lBRUQsSUFBVyxHQUFHO1FBQ1YsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDO0lBQ3JCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksU0FBUyxDQUFDLEdBQVM7UUFDdEIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBRWxCLElBQUksY0FBYyxHQUFHLElBQUksQ0FBQztRQUMxQixHQUFHLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBdUIsRUFBRSxFQUFFO1lBQ3BDLElBQUksY0FBYyxFQUFFO2dCQUNoQixjQUFjLEdBQUcsS0FBSyxDQUFDO2FBQzFCO2lCQUFNO2dCQUNILFFBQVEsSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDO2FBQy9CO1lBRUQsUUFBUSxJQUFJLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsRCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sUUFBUSxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksZ0JBQWdCLENBQUMsVUFBdUI7UUFDM0MsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLE1BQU0sTUFBTSxHQUFHLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNsQyxJQUFJLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDWixRQUFRLElBQUksTUFBTSxDQUFDO1NBQ3RCO1FBRUQsTUFBTSxLQUFLLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQztRQUMvQixJQUFJLEtBQUssS0FBSyxHQUFHLEVBQUU7WUFDZixRQUFRLElBQUksSUFBSSxDQUFDO1NBQ3BCO2FBQU07WUFDSCxRQUFRLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQztTQUMzQjtRQUNELE1BQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDckMsSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUFFO1lBQ2QsUUFBUSxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ3hDO2FBQU0sSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUFFO1lBQ3JCLFFBQVEsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQztTQUN4QztRQUVELE1BQU0sVUFBVSxHQUFHLFVBQVUsQ0FBQyxVQUFVLENBQUM7UUFDekMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxFQUFFO1lBQ2hCLFFBQVEsSUFBSSxHQUFHLEdBQUcsVUFBVSxDQUFDO1NBQ2hDO1FBRUQsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVEOztPQUVHO0lBQ0ksVUFBVSxDQUFDLElBQVc7UUFDekIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksSUFBSSxDQUFDLEdBQUcsS0FBSyxHQUFHLEVBQUU7WUFDbEIsUUFBUSxJQUFJLElBQUksQ0FBQztTQUNwQjthQUFNO1lBQ0gsUUFBUSxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1NBQzlCO1FBQ0QsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7T0FHRztJQUNJLFNBQVMsQ0FBQyxRQUFnQjtRQUM3QixNQUFNLGVBQWUsR0FBRyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUN0RSxNQUFNLEdBQUcsR0FBRyxJQUFJLFNBQUcsRUFBRSxDQUFDO1FBRXRCLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxjQUFzQixFQUFFLEVBQUU7WUFDL0MsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQztRQUNwRCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sR0FBRyxDQUFDO0lBQ2YsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxnQkFBZ0IsQ0FBQyxRQUFnQjtRQUNwQyxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDZixJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7UUFDbkIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRWpCLElBQUksUUFBUSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFbkMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXRELFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRWxDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO1lBQzdCLFVBQVUsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEM7UUFFRCxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxFQUFFO1lBQ3JDLFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2xDLFFBQVEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUM3RDthQUFNLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLEVBQUU7WUFDNUMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDbEMsUUFBUSxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztTQUNqRTtRQUVELElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBRTtZQUNyQixLQUFLLEdBQUcsR0FBRyxDQUFDO1NBQ2Y7YUFBTTtZQUNILEtBQUssR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDL0I7UUFFRCxPQUFPLElBQUksdUJBQVUsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRU0sVUFBVSxDQUFDLFFBQWdCO1FBQzlCLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsS0FBSyxHQUFHLEVBQUU7WUFDMUMsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1NBQzVDO1FBQ0QsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3QyxPQUFPLElBQUksV0FBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ssUUFBUSxDQUFDLE1BQWM7UUFDM0IsT0FBTyxDQUFDLE1BQU0sSUFBSSxNQUFNLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztJQUMxQyxDQUFDO0NBQ0o7QUF4SkQsc0NBd0pDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgICBDb2xsZWN0aW9uLFxuICAgIElDb2xsZWN0aW9uXG59IGZyb20gJy4vQ29sbGVjdGlvbic7XG5pbXBvcnQge1xuICAgIEN1cCxcbiAgICBJQ3VwXG59IGZyb20gJy4vQ3VwJztcbmltcG9ydCB7XG4gICAgRGljZSxcbiAgICBJRGljZVxufSBmcm9tICcuL0RpY2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIElOb3RhdGlvbkNvZGVjIHtcbiAgICBnZXQgY3VwKCk6IHN0cmluZztcbiAgICBlbmNvZGVDdXAoY3VwOiBJQ3VwKTogc3RyaW5nO1xuICAgIGVuY29kZUNvbGxlY3Rpb24oY29sbGVjdGlvbjogSUNvbGxlY3Rpb24pOiBzdHJpbmc7XG4gICAgZW5jb2RlRGljZShkaWNlOiBJRGljZSk6IHN0cmluZztcbiAgICBkZWNvZGVDdXAobm90YXRpb246IHN0cmluZyk6IElDdXA7XG4gICAgZGVjb2RlQ29sbGVjdGlvbihub3RhdGlvbjogc3RyaW5nKTogSUNvbGxlY3Rpb247XG4gICAgZGVjb2RlRGljZShub3RhdGlvbjogc3RyaW5nKTogSURpY2U7IFxufVxuXG4vKipcbiAqIENvZGVjIHRoYXQgZW5jb2RlcyBvYmplY3RzIHRvIG5vdGF0aW9ucyBhbmQgZGVjb2RlcyBub3RhdGlvbnMgdG8gb2JqZWN0cy5cbiAqL1xuZXhwb3J0IGNsYXNzIE5vdGF0aW9uQ29kZWMge1xuICAgIHByaXZhdGUgX3NlcGFyYXRvcjogc3RyaW5nID0gJywnO1xuICAgIHByaXZhdGUgX2N1cDogc3RyaW5nID0gJzInO1xuXG4gICAgLy9wcml2YXRlIF9jdXA7XG5cbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vbmFtZTogc3RyaW5nKSB7XG4gICAgICAgIC8vICB0aGlzLl9jdXAgPSBuYW1lO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXQgY3VwKCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jdXA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIGZyb20gYSBjdXAgdG8gYSBzdHJpbmdcbiAgICAgKiBAcGFyYW0gY3VwIC0gdGhlIGN1cCB0byBlbmNvZGVcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIHB1YmxpYyBlbmNvZGVDdXAoY3VwOiBJQ3VwKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG5vdGF0aW9uID0gJyc7XG5cbiAgICAgICAgbGV0IGZpcnN0SXRlcmF0aW9uID0gdHJ1ZTtcbiAgICAgICAgY3VwLmZvckVhY2goKGNvbGxlY3Rpb246IElDb2xsZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmlyc3RJdGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBmaXJzdEl0ZXJhdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3RhdGlvbiArPSB0aGlzLl9zZXBhcmF0b3I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vdGF0aW9uICs9IHRoaXMuZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG5vdGF0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuY29kZSBmcm9tIGEgY29sbGVjdGlvbiB0byBhIHN0cmluZ1xuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uIC0gdGhlIGNvbGxlY3Rpb24gdG8gZW5jb2RlXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBwdWJsaWMgZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBJQ29sbGVjdGlvbik6IHN0cmluZyB7XG4gICAgICAgIGxldCBub3RhdGlvbiA9ICcnO1xuICAgICAgICBjb25zdCBhbW91bnQgPSBjb2xsZWN0aW9uLmNvdW50KCk7XG4gICAgICAgIGlmIChhbW91bnQgPiAxKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSBhbW91bnQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzaWRlcyA9IGNvbGxlY3Rpb24uc2lkZXM7XG4gICAgICAgIGlmIChzaWRlcyA9PT0gMTAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnZCUnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm90YXRpb24gKz0gJ2QnICsgc2lkZXM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSBjb2xsZWN0aW9uLm1vZGlmaWVyO1xuICAgICAgICBpZiAobW9kaWZpZXIgPiAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnKycgKyBNYXRoLmFicyhtb2RpZmllcik7XG4gICAgICAgIH0gZWxzZSBpZiAobW9kaWZpZXIgPCAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnLScgKyBNYXRoLmFicyhtb2RpZmllcik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gY29sbGVjdGlvbi5tdWx0aXBsaWVyO1xuICAgICAgICBpZiAobXVsdGlwbGllciA+IDEpIHtcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICcqJyArIG11bHRpcGxpZXI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbm90YXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIGZyb20gYSBkaWNlIHRvIGEgc3RyaW5nXG4gICAgICovXG4gICAgcHVibGljIGVuY29kZURpY2UoZGljZTogSURpY2UpOiBzdHJpbmcge1xuICAgICAgICBsZXQgbm90YXRpb24gPSAnJztcbiAgICAgICAgaWYgKGRpY2UubWF4ID09PSAxMDApIHtcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICdkJSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnZCcgKyBkaWNlLm1heDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm90YXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBhIGRpY2UgY3VwIG5vdGF0aW9uXG4gICAgICogQHBhcmFtIG5vdGF0aW9uIC0gMWQ2KzIqOCwxZDEwLDJkJVxuICAgICAqL1xuICAgIHB1YmxpYyBkZWNvZGVDdXAobm90YXRpb246IHN0cmluZyk6IElDdXAge1xuICAgICAgICBjb25zdCBleHByZXNzaW9uUGFydHMgPSBub3RhdGlvbi50b0xvd2VyQ2FzZSgpLnNwbGl0KHRoaXMuX3NlcGFyYXRvcik7XG4gICAgICAgIGNvbnN0IGN1cCA9IG5ldyBDdXAoKTtcblxuICAgICAgICBleHByZXNzaW9uUGFydHMuZm9yRWFjaCgoZXhwcmVzc2lvblBhcnQ6IHN0cmluZykgPT4ge1xuICAgICAgICAgICAgY3VwLnB1c2godGhpcy5kZWNvZGVDb2xsZWN0aW9uKGV4cHJlc3Npb25QYXJ0KSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJldHVybiBjdXA7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBhIGRpY2UgY29sbGVjdGlvbiBub3RhdGlvblxuICAgICAqIEBwYXJhbSBub3RhdGlvbiAtIDFkNisyKjhcbiAgICAgKiBAcmV0dXJucyBJQ29sbGVjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBkZWNvZGVDb2xsZWN0aW9uKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ29sbGVjdGlvbiB7XG4gICAgICAgIGxldCBhbW91bnQgPSAxO1xuICAgICAgICBsZXQgc2lkZXMgPSAyO1xuICAgICAgICBsZXQgbXVsdGlwbGllciA9IDE7XG4gICAgICAgIGxldCBtb2RpZmllciA9IDA7XG5cbiAgICAgICAgbGV0IHVuc29ydGVkID0gbm90YXRpb24uc3BsaXQoJ2QnKTtcblxuICAgICAgICBhbW91bnQgPSB1bnNvcnRlZFswXSAhPT0gJycgPyBOdW1iZXIodW5zb3J0ZWRbMF0pIDogMTtcblxuICAgICAgICB1bnNvcnRlZCA9IHVuc29ydGVkWzFdLnNwbGl0KCcqJyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLl9pc0VtcHR5KHVuc29ydGVkWzFdKSkge1xuICAgICAgICAgICAgbXVsdGlwbGllciA9IE51bWJlcih1bnNvcnRlZFsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodW5zb3J0ZWRbMF0uaW5jbHVkZXMoJysnKSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHVuc29ydGVkID0gdW5zb3J0ZWRbMF0uc3BsaXQoJysnKTtcbiAgICAgICAgICAgIG1vZGlmaWVyID0gdW5zb3J0ZWRbMV0gIT09IG51bGwgPyBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcbiAgICAgICAgfSBlbHNlIGlmICh1bnNvcnRlZFswXS5pbmNsdWRlcygnLScpICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdW5zb3J0ZWQgPSB1bnNvcnRlZFswXS5zcGxpdCgnLScpO1xuICAgICAgICAgICAgbW9kaWZpZXIgPSB1bnNvcnRlZFsxXSAhPT0gbnVsbCA/IDAgLSBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1bnNvcnRlZFswXSA9PT0gJyUnKSB7XG4gICAgICAgICAgICBzaWRlcyA9IDEwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNpZGVzID0gTnVtYmVyKHVuc29ydGVkWzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvbihhbW91bnQsIHNpZGVzLCBtb2RpZmllciwgbXVsdGlwbGllcik7XG4gICAgfVxuXG4gICAgcHVibGljIGRlY29kZURpY2Uobm90YXRpb246IHN0cmluZyk6IElEaWNlIHtcbiAgICAgICAgaWYgKG5vdGF0aW9uLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICE9PSAnZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkaWNlIG5vdGF0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbnVtYmVyID0gTnVtYmVyKG5vdGF0aW9uLnN1YnN0cmluZygxKSk7XG4gICAgICAgIHJldHVybiBuZXcgRGljZShudW1iZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGV0aGVyIHN0cmluZyBpcyBlbXB0eSBvciBub3RcbiAgICAgKiBAcGFyYW0gc3RyaW5nIC0gdGhlIHN0cmluZyB0byBjaGVja1xuICAgICAqIEByZXR1cm5zXG4gICAgICovXG4gICAgcHJpdmF0ZSBfaXNFbXB0eShzdHJpbmc6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgICAgICByZXR1cm4gIXN0cmluZyB8fCBzdHJpbmcubGVuZ3RoID09PSAwO1xuICAgIH1cbn1cbiJdfQ==