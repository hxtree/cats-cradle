"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.NotationCodec = void 0;
const Collection_1 = require("./Collection");
const Cup_1 = require("./Cup");
const Dice_1 = require("./Dice");
/**
 * Codec that encodes objects to notations and decodes notations to objects.
 */
class NotationCodec {
    //private _cup;
    constructor() {
        this._separator = ',';
        this._cup = '2';
        //name: string) {
        //  this._cup = name;
    }
    get cup() {
        return this._cup;
    }
    /**
     * Encode from a cup to a string
     * @param cup
     * @returns
     */
    encodeCup(cup) {
        let notation = '';
        let firstIteration = true;
        cup.forEach((collection) => {
            if (firstIteration) {
                firstIteration = false;
            }
            else {
                notation += this._separator;
            }
            notation += this.encodeCollection(collection);
        });
        return notation;
    }
    /**
     * Encode from a collection to a string
     * @param collection
     * @returns
     */
    encodeCollection(collection) {
        let notation = '';
        const amount = collection.count();
        if (amount > 1) {
            notation += amount;
        }
        const sides = collection.sides;
        if (sides === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + sides;
        }
        const modifier = collection.modifier;
        if (modifier > 0) {
            notation += '+' + Math.abs(modifier);
        }
        else if (modifier < 0) {
            notation += '-' + Math.abs(modifier);
        }
        const multiplier = collection.multiplier;
        if (multiplier > 1) {
            notation += '*' + multiplier;
        }
        return notation;
    }
    /**
     * Encode from a dice to a string
     */
    encodeDice(dice) {
        let notation = '';
        if (dice.max === 100) {
            notation += 'd%';
        }
        else {
            notation += 'd' + dice.max;
        }
        return notation;
    }
    /**
     * Decodes a dice cup notation
     * @param notation 1d6+2*8,1d10,2d%
     */
    decodeCup(notation) {
        const expressionParts = notation.toLowerCase().split(this._separator);
        const cup = new Cup_1.Cup();
        expressionParts.forEach((expressionPart) => {
            cup.push(this.decodeCollection(expressionPart));
        });
        return cup;
    }
    /**
     * Decodes a dice collection notation
     * @param notation 1d6+2*8
     * @returns ICollection
     */
    decodeCollection(notation) {
        let amount = 1;
        let sides = 2;
        let multiplier = 1;
        let modifier = 0;
        let unsorted = notation.split('d');
        amount = unsorted[0] !== '' ? Number(unsorted[0]) : 1;
        unsorted = unsorted[1].split('*');
        if (!this._isEmpty(unsorted[1])) {
            multiplier = Number(unsorted[1]);
        }
        if (unsorted[0].includes('+') !== false) {
            unsorted = unsorted[0].split('+');
            modifier = unsorted[1] !== null ? Number(unsorted[1]) : 0;
        }
        else if (unsorted[0].includes('-') !== false) {
            unsorted = unsorted[0].split('-');
            modifier = unsorted[1] !== null ? 0 - Number(unsorted[1]) : 0;
        }
        if (unsorted[0] === '%') {
            sides = 100;
        }
        else {
            sides = Number(unsorted[0]);
        }
        return new Collection_1.Collection(amount, sides, modifier, multiplier);
    }
    decodeDice(notation) {
        if (notation.charAt(0).toLowerCase() !== 'd') {
            throw new Error('Invalid dice notation');
        }
        const number = Number(notation.substring(1));
        return new Dice_1.Dice(number);
    }
    /**
     * Determine whether string is empty or not
     * @param string
     * @returns
     */
    _isEmpty(string) {
        return !string || string.length === 0;
    }
}
exports.NotationCodec = NotationCodec;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTm90YXRpb25Db2RlYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL05vdGF0aW9uQ29kZWMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsNkNBR3NCO0FBQ3RCLCtCQUdlO0FBQ2YsaUNBR2dCO0FBWWhCOztHQUVHO0FBQ0gsTUFBYSxhQUFhO0lBSXRCLGVBQWU7SUFFZjtRQUxRLGVBQVUsR0FBVyxHQUFHLENBQUM7UUFDekIsU0FBSSxHQUFXLEdBQUcsQ0FBQztRQUt2QixpQkFBaUI7UUFDakIscUJBQXFCO0lBQ3pCLENBQUM7SUFFRCxJQUFXLEdBQUc7UUFDVixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxTQUFTLENBQUMsR0FBUztRQUN0QixJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFFbEIsSUFBSSxjQUFjLEdBQUcsSUFBSSxDQUFDO1FBQzFCLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUF1QixFQUFFLEVBQUU7WUFDcEMsSUFBSSxjQUFjLEVBQUU7Z0JBQ2hCLGNBQWMsR0FBRyxLQUFLLENBQUM7YUFDMUI7aUJBQU07Z0JBQ0gsUUFBUSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUM7YUFDL0I7WUFFRCxRQUFRLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2xELENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxRQUFRLENBQUM7SUFDcEIsQ0FBQztJQUVEOzs7O09BSUc7SUFDSSxnQkFBZ0IsQ0FBQyxVQUF1QjtRQUMzQyxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsTUFBTSxNQUFNLEdBQUcsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2xDLElBQUksTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNaLFFBQVEsSUFBSSxNQUFNLENBQUM7U0FDdEI7UUFFRCxNQUFNLEtBQUssR0FB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QUM7Q0FDSjtBQXhKRCxzQ0F3SkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICAgIENvbGxlY3Rpb24sXG4gICAgSUNvbGxlY3Rpb25cbn0gZnJvbSAnLi9Db2xsZWN0aW9uJztcbmltcG9ydCB7XG4gICAgQ3VwLFxuICAgIElDdXBcbn0gZnJvbSAnLi9DdXAnO1xuaW1wb3J0IHtcbiAgICBEaWNlLFxuICAgIElEaWNlXG59IGZyb20gJy4vRGljZSc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSU5vdGF0aW9uQ29kZWMge1xuICAgIGdldCBjdXAoKTogc3RyaW5nO1xuICAgIGVuY29kZUN1cChjdXA6IElDdXApOiBzdHJpbmc7XG4gICAgZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBJQ29sbGVjdGlvbik6IHN0cmluZztcbiAgICBlbmNvZGVEaWNlKGRpY2U6IElEaWNlKTogc3RyaW5nO1xuICAgIGRlY29kZUN1cChub3RhdGlvbjogc3RyaW5nKTogSUN1cDtcbiAgICBkZWNvZGVDb2xsZWN0aW9uKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ29sbGVjdGlvbjtcbiAgICBkZWNvZGVEaWNlKG5vdGF0aW9uOiBzdHJpbmcpOiBJRGljZTsgXG59XG5cbi8qKlxuICogQ29kZWMgdGhhdCBlbmNvZGVzIG9iamVjdHMgdG8gbm90YXRpb25zIGFuZCBkZWNvZGVzIG5vdGF0aW9ucyB0byBvYmplY3RzLlxuICovXG5leHBvcnQgY2xhc3MgTm90YXRpb25Db2RlYyB7XG4gICAgcHJpdmF0ZSBfc2VwYXJhdG9yOiBzdHJpbmcgPSAnLCc7XG4gICAgcHJpdmF0ZSBfY3VwOiBzdHJpbmcgPSAnMic7XG5cbiAgICAvL3ByaXZhdGUgX2N1cDtcblxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy9uYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgLy8gIHRoaXMuX2N1cCA9IG5hbWU7XG4gICAgfVxuXG4gICAgcHVibGljIGdldCBjdXAoKTogc3RyaW5nIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2N1cDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBFbmNvZGUgZnJvbSBhIGN1cCB0byBhIHN0cmluZ1xuICAgICAqIEBwYXJhbSBjdXBcbiAgICAgKiBAcmV0dXJuc1xuICAgICAqL1xuICAgIHB1YmxpYyBlbmNvZGVDdXAoY3VwOiBJQ3VwKTogc3RyaW5nIHtcbiAgICAgICAgbGV0IG5vdGF0aW9uID0gJyc7XG5cbiAgICAgICAgbGV0IGZpcnN0SXRlcmF0aW9uID0gdHJ1ZTtcbiAgICAgICAgY3VwLmZvckVhY2goKGNvbGxlY3Rpb246IElDb2xsZWN0aW9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmlyc3RJdGVyYXRpb24pIHtcbiAgICAgICAgICAgICAgICBmaXJzdEl0ZXJhdGlvbiA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBub3RhdGlvbiArPSB0aGlzLl9zZXBhcmF0b3I7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIG5vdGF0aW9uICs9IHRoaXMuZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIG5vdGF0aW9uO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIEVuY29kZSBmcm9tIGEgY29sbGVjdGlvbiB0byBhIHN0cmluZ1xuICAgICAqIEBwYXJhbSBjb2xsZWN0aW9uXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBwdWJsaWMgZW5jb2RlQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBJQ29sbGVjdGlvbik6IHN0cmluZyB7XG4gICAgICAgIGxldCBub3RhdGlvbiA9ICcnO1xuICAgICAgICBjb25zdCBhbW91bnQgPSBjb2xsZWN0aW9uLmNvdW50KCk7XG4gICAgICAgIGlmIChhbW91bnQgPiAxKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSBhbW91bnQ7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBzaWRlcyA9IGNvbGxlY3Rpb24uc2lkZXM7XG4gICAgICAgIGlmIChzaWRlcyA9PT0gMTAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnZCUnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm90YXRpb24gKz0gJ2QnICsgc2lkZXM7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbW9kaWZpZXIgPSBjb2xsZWN0aW9uLm1vZGlmaWVyO1xuICAgICAgICBpZiAobW9kaWZpZXIgPiAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnKycgKyBNYXRoLmFicyhtb2RpZmllcik7XG4gICAgICAgIH0gZWxzZSBpZiAobW9kaWZpZXIgPCAwKSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnLScgKyBNYXRoLmFicyhtb2RpZmllcik7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gY29sbGVjdGlvbi5tdWx0aXBsaWVyO1xuICAgICAgICBpZiAobXVsdGlwbGllciA+IDEpIHtcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICcqJyArIG11bHRpcGxpZXI7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbm90YXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRW5jb2RlIGZyb20gYSBkaWNlIHRvIGEgc3RyaW5nXG4gICAgICovXG4gICAgcHVibGljIGVuY29kZURpY2UoZGljZTogSURpY2UpOiBzdHJpbmcge1xuICAgICAgICBsZXQgbm90YXRpb24gPSAnJztcbiAgICAgICAgaWYgKGRpY2UubWF4ID09PSAxMDApIHtcbiAgICAgICAgICAgIG5vdGF0aW9uICs9ICdkJSc7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBub3RhdGlvbiArPSAnZCcgKyBkaWNlLm1heDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbm90YXRpb247XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBhIGRpY2UgY3VwIG5vdGF0aW9uXG4gICAgICogQHBhcmFtIG5vdGF0aW9uIDFkNisyKjgsMWQxMCwyZCVcbiAgICAgKi9cbiAgICBwdWJsaWMgZGVjb2RlQ3VwKG5vdGF0aW9uOiBzdHJpbmcpIDogSUN1cCB7XG4gICAgICAgIGNvbnN0IGV4cHJlc3Npb25QYXJ0cyA9IG5vdGF0aW9uLnRvTG93ZXJDYXNlKCkuc3BsaXQodGhpcy5fc2VwYXJhdG9yKTtcbiAgICAgICAgY29uc3QgY3VwID0gbmV3IEN1cCgpO1xuXG4gICAgICAgIGV4cHJlc3Npb25QYXJ0cy5mb3JFYWNoKChleHByZXNzaW9uUGFydDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICBjdXAucHVzaCh0aGlzLmRlY29kZUNvbGxlY3Rpb24oZXhwcmVzc2lvblBhcnQpKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGN1cDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBEZWNvZGVzIGEgZGljZSBjb2xsZWN0aW9uIG5vdGF0aW9uXG4gICAgICogQHBhcmFtIG5vdGF0aW9uIDFkNisyKjhcbiAgICAgKiBAcmV0dXJucyBJQ29sbGVjdGlvblxuICAgICAqL1xuICAgIHB1YmxpYyBkZWNvZGVDb2xsZWN0aW9uKG5vdGF0aW9uOiBzdHJpbmcpOiBJQ29sbGVjdGlvbiB7XG4gICAgICAgIGxldCBhbW91bnQgPSAxO1xuICAgICAgICBsZXQgc2lkZXMgPSAyO1xuICAgICAgICBsZXQgbXVsdGlwbGllciA9IDE7XG4gICAgICAgIGxldCBtb2RpZmllciA9IDA7XG5cbiAgICAgICAgbGV0IHVuc29ydGVkID0gbm90YXRpb24uc3BsaXQoJ2QnKTtcblxuICAgICAgICBhbW91bnQgPSB1bnNvcnRlZFswXSAhPT0gJycgPyBOdW1iZXIodW5zb3J0ZWRbMF0pIDogMTtcblxuICAgICAgICB1bnNvcnRlZCA9IHVuc29ydGVkWzFdLnNwbGl0KCcqJyk7XG5cbiAgICAgICAgaWYgKCF0aGlzLl9pc0VtcHR5KHVuc29ydGVkWzFdKSkge1xuICAgICAgICAgICAgbXVsdGlwbGllciA9IE51bWJlcih1bnNvcnRlZFsxXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodW5zb3J0ZWRbMF0uaW5jbHVkZXMoJysnKSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHVuc29ydGVkID0gdW5zb3J0ZWRbMF0uc3BsaXQoJysnKTtcbiAgICAgICAgICAgIG1vZGlmaWVyID0gdW5zb3J0ZWRbMV0gIT09IG51bGwgPyBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcbiAgICAgICAgfSBlbHNlIGlmICh1bnNvcnRlZFswXS5pbmNsdWRlcygnLScpICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdW5zb3J0ZWQgPSB1bnNvcnRlZFswXS5zcGxpdCgnLScpO1xuICAgICAgICAgICAgbW9kaWZpZXIgPSB1bnNvcnRlZFsxXSAhPT0gbnVsbCA/IDAgLSBOdW1iZXIodW5zb3J0ZWRbMV0pIDogMDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1bnNvcnRlZFswXSA9PT0gJyUnKSB7XG4gICAgICAgICAgICBzaWRlcyA9IDEwMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHNpZGVzID0gTnVtYmVyKHVuc29ydGVkWzBdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvbihhbW91bnQsIHNpZGVzLCBtb2RpZmllciwgbXVsdGlwbGllcik7XG4gICAgfVxuXG4gICAgcHVibGljIGRlY29kZURpY2Uobm90YXRpb246IHN0cmluZyk6IElEaWNlIHtcbiAgICAgICAgaWYgKG5vdGF0aW9uLmNoYXJBdCgwKS50b0xvd2VyQ2FzZSgpICE9PSAnZCcpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBkaWNlIG5vdGF0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbnVtYmVyID0gTnVtYmVyKG5vdGF0aW9uLnN1YnN0cmluZygxKSk7XG4gICAgICAgIHJldHVybiBuZXcgRGljZShudW1iZXIpO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGV0aGVyIHN0cmluZyBpcyBlbXB0eSBvciBub3RcbiAgICAgKiBAcGFyYW0gc3RyaW5nXG4gICAgICogQHJldHVybnNcbiAgICAgKi9cbiAgICBwcml2YXRlIF9pc0VtcHR5KHN0cmluZzogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgICAgIHJldHVybiAhc3RyaW5nIHx8IHN0cmluZy5sZW5ndGggPT09IDA7XG4gICAgfVxufVxuIl19